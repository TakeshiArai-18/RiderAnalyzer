# ソフトウェア仕様書: Lap Time Analyzer for Rider Performance Visualization

## 1. ソフトウェア名

Lap Time Analyzer for Rider Performance Visualization

## 2. ソフトウェア概要

本ソフトウェアは、バイクレースにおけるライダーのラップタイムデータを分析し、ライダーの強みと弱みを可視化することを目的とします。ラップタイムの平均値、標準偏差に加え、セクターごとの詳細な分析を行うことで、ライダーのパフォーマンスを多角的に評価し、改善点を特定することを支援します。JSON形式を標準のデータ形式とし、CSV形式のデータ読み込みにも対応します。

## 3. 主な機能

### 3.1 データ入力機能

*   JSON形式のラップタイムデータファイルを標準で読み込みます。
*   CSV形式のラップタイムデータファイル読み込み機能もサポートします。
*   テーブル形式でのラップタイムデータ入力機能を提供します。(mm:ss.fff形式)
*   CSVファイル読み込み時など、データ形式を柔軟に対応するため、設定画面でカラムの指定を可能とします。（例：ラップタイム、セクター1タイム、セクター2タイム、セクター3タイムなど）
*   複数のライダーのデータを同時に読み込み、比較分析を可能とします。

### 3.2 ラップタイム分析機能

*   平均ラップタイム: 全ラップタイムの平均値を計算します。
*   ラップタイム標準偏差: ラップタイムのばらつきを示す標準偏差を計算します。
*   ラップタイムヒストグラム: ラップタイムの分布をヒストグラムで可視化します。
*   ラップタイム時系列グラフ: ラップタイムの推移を時系列グラフで可視化します。

### 3.3 セクタータイム分析機能

*   セクター別平均タイム: 各セクターの平均タイムを計算します。
*   セクター別タイム標準偏差: 各セクターのタイムの標準偏差を計算します。
*   セクター別平均タイム比較: 複数ライダーのセクター別平均タイムを棒グラフなどで比較表示します。
*   セクタータイム時系列グラフ: 各セクタータイムの推移を時系列グラフで可視化します。

### 3.4 ライダーパフォーマンス可視化機能

*   レーダーチャート: ラップタイム、セクタータイムの平均値や標準偏差をレーダーチャートで可視化し、ライダーの強み・弱みを視覚的に表現します。
*   セクター別パフォーマンス比較: 各セクターにおける複数ライダーのパフォーマンスを比較し、得意・不得意なセクターを特定します。
*   データテーブル表示: 分析結果を数値データとしてテーブル形式で表示します。
    *   色分け表示:
        *   最速ラップ： 緑色 (例: #90EE90 薄緑色)
        *   最遅ラップ： 赤色 (例: #F08080 薄紅色)
        *   最速セクター： 青色 (例: #ADD8E6 水色)
        *   最遅セクター： オレンジ色 (例: #FFA07A ライトオレンジ)
    *   色分け表示により、ライダーのベストラップ、ワーストラップ、各セクターの得意・不得意を明確に示します。

### 3.5 UI機能

*   **メイン画面:**
    *   データ入力エリア
        *   JSONファイル読み込みボタン (標準)
        *   CSVファイル読み込みボタン (オプション)
        *   テーブル形式データ入力エリア (ExcelライクなテーブルUI、mm:ss.fff形式入力)
    *   グラフ表示エリア (ラップタイム、セクタータイム、レーダーチャートなど)
    *   データテーブル表示エリア (色分け表示)
    *   設定ボタン (データカラム設定、グラフ設定、色設定など)

*   **設定画面:**
    *   データカラム設定 (CSVファイル読み込み時のカラム設定など)
    *   グラフ設定 (グラフの種類、色、凡例などを設定)
    *   色設定 (最速/最遅ラップ、セクターの色分け設定)

### 3.6 その他機能

*   分析結果のエクスポート: 分析結果のグラフやデータテーブルを画像ファイルやCSVファイルとしてエクスポートします。
*   データ保存 (標準形式): ラップタイムデータを JSON形式で保存します。保存ファイル名はユーザーが任意に設定可能です。
*   ヘルプ機能: ソフトウェアの使い方や機能説明を表示します。
*   vnve環境構築用のbatファイルの提供とPythonライブラリのrequirements.txtの提供、及びソフトウエア起動用のbatファイルの提供

## 4. 開発環境

*   **開発言語:** Python
*   **UIフレームワーク:** PyQt5
*   **仮想環境:** venv (Python仮想環境)
*   **実行環境:** Windows PC (ローカル環境)
*   **その他ライブラリ:**
    *   データ分析: pandas, numpy
    *   グラフ描画: matplotlib, seaborn (plotlyも検討可)
    *   UI: PyQt5

## 5. ソフトウェアアーキテクチャ (高レベル)

UI層 (PyQt5): ユーザーインターフェースを提供し、ユーザーからの入力を受け付け、結果を表示します。メイン画面、設定画面、グラフ表示エリア、データテーブル表示エリアなどで構成されます。

アプリケーション層 (Python): UI層からの指示を受け取り、データ処理層と連携してデータ分析処理を実行します。データの読み込み、分析ロジックの実行、結果のUI層への受け渡しを行います。

データ処理層 (Python, pandas, numpy): ラップタイムデータの読み込み (JSON, CSV, テーブル入力)、データクリーニング、データ分析処理を行います。平均値、標準偏差、ヒストグラム、時系列グラフ、最速/最遅ラップ/セクター特定などの計算処理を実装します。

可視化層 (Python, matplotlib, seaborn, plotly, PyQt5): 分析結果をグラフやチャートとして可視化します。ラップタイムヒストグラム、時系列グラフ、レーダーチャート、棒グラフ、色分けデータテーブル表示などを生成します。

## 6. データ入力フォーマット

### 6.1. テーブル入力フォーマット

| Rider | Lap | LapTime (mm:ss.fff) | Sector1 (ss.fff) | Sector2 (ss.fff) | Sector3 (ss.fff) |
| :---- | :-: | :------------------ | :--------------- | :--------------- | :--------------- |
| RiderA |  1  | 01:50.123           | 30.123           | 40.456           | 39.544           |
| RiderA |  2  | 01:49.876           | 29.987           | 40.321           | 39.568           |
| RiderB |  1  | 01:52.345           | 31.234           | 41.567           | 39.544           |
| RiderB |  2  | 01:51.987           | 30.987           | 41.321           | 39.679           |
| ...   | ... | ...                 | ...                 | ...                 | ...                 |

テーブル形式でソフトウェア上で直接データを入力する場合のフォーマットです。`LapTime`, `Sector1`, `Sector2`, `Sector3` カラムは `mm:ss.fff` および `ss.fff` 形式で入力します。`Rider`, `Lap` カラムはテキストまたは数値で入力します。

### 6.2. CSVファイルフォーマット

CSVファイルからのラップタイムデータ読み込みもサポートします。CSVファイルのフォーマットは以下の通りとします。

*   ファイル形式: カンマ区切り (,) のテキストファイル (.csv)
*   ヘッダー行: 必須 (カラム名を1行目に記載)
*   必須カラム:
    *   `Rider` (ライダー名): テキスト形式
    *   `Lap` (ラップ番号): 数値形式 (整数)
    *   `LapTime` (ラップタイム): テキスト形式 (mm:ss.fff 形式)
*   オプションカラム (セクタータイム):
    *   `Sector1` (セクター1タイム): テキスト形式 (ss.fff 形式)
    *   `Sector2` (セクター2タイム): テキスト形式 (ss.fff 形式)
    *   `Sector3` (セクター3タイム): テキスト形式 (ss.fff 形式)
*   セクター数は最大3つまでを想定していますが、ソフトウェア設定で変更可能とすることが望ましいです。
*   タイムフォーマット:
    *   `LapTime`: mm:ss.fff (分:秒.ミリ秒) 形式
    *   `Sector1`, `Sector2`, `Sector3`: ss.fff (秒.ミリ秒) 形式
*   文字コード: UTF-8 (推奨)

**CSVファイル例:**

Rider,Lap,LapTime,Sector1,Sector2,Sector3
RiderA,1,01:50.123,30.123,40.456,39.544
RiderA,2,01:49.876,29.987,40.321,39.568
RiderB,1,01:52.345,31.234,41.567,39.544
RiderB,2,01:51.987,30.987,41.321,39.679
...

設定画面でのカラム指定: CSVファイルのカラム名が上記と異なる場合や、セクター数が異なる場合を考慮し、設定画面でCSVファイルの各カラムがどのデータに対応するかを指定できるようにします。

## 7. データ保存フォーマット (JSONファイル例)

    {
      "fileName": "race_data_20250210.json",
      "data": [
        {
          "rider": "RiderA",
          "lap_data": [
            {
              "lap_number": 1,
              "lap_time": "01:50.123",
              "sector1_time": "30.123",
              "sector2_time": "40.456",
              "sector3_time": "39.544"
            },
            {
              "lap_number": 2,
              "lap_time": "01:49.876",
              "sector1_time": "29.987",
              "sector2_time": "40.321",
              "sector3_time": "39.568"
            }
          ]
        },
        {
          "rider": "RiderB",
          "lap_data": [
            {
              "lap_number": 1,
              "lap_time": "01:52.345",
              "sector1_time": "31.234",
              "sector2_time": "41.567",
              "sector3_time": "39.544"
            },
            {
              "lap_number": 2,
              "lap_time": "01:51.987",
              "sector1_time": "30.987",
              "sector2_time": "41.321",
              "sector3_time": "39.679"
            }
          ]
        }
      ]
    }

JSON形式でデータを保存します。`fileName` には保存ファイル名を記録します。`data` 配列には、ライダーごとのデータが格納されます。`rider` にはライダー名を記録します。`lap_data` 配列には、ラップごとのデータが格納されます。`lap_number`, `lap_time`, `sector1_time`, `sector2_time`, `sector3_time` には、それぞれのデータを記録します。タイムデータは `mm:ss.fff` および `ss.fff` 形式の文字列として保存します。