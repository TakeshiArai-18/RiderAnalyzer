# RiderAnalyzer 取扱説明書

## 1. 概要

RiderAnalyzerは、ライダーのラップタイムデータを分析・可視化するためのソフトウェアです。レース中や練習走行中のラップタイムやセクタータイムを詳細に分析し、ライダーのパフォーマンスを向上させるための洞察を提供します。

## 2. 主な機能

- ラップタイムとセクタータイムの記録と分析
- 複数ライダーのパフォーマンス比較
- グラフによる視覚化（ラップタイム推移、セクタータイム比較など）
- JSON形式およびCSV形式のデータの読み込みと保存
- タイヤタイプ、天候、路面温度などの走行条件の記録
- セッション情報（トラック名、日付）をファイル名に自動反映

## 3. インストールと起動方法

### 3.1 インストール

1. リポジトリをクローンします：
   ```
   git clone https://github.com/TakeshiArai-18/RiderAnalyzer.git
   ```

2. クローンしたディレクトリに移動します：
   ```
   cd RiderAnalyzer
   ```

3. `scripts`ディレクトリに移動します：
   ```
   cd scripts
   ```

4. 仮想環境を作成し、必要なライブラリをインストールします：
   ```
   create_venv.bat
   ```
   
   このバッチファイルは以下の処理を行います：
   - Python仮想環境（venv）を作成
   - 仮想環境を有効化
   - pipをアップグレード
   - requirements.txtに記載された必要なライブラリをインストール：
     - PyQt5, pandas, numpy, matplotlib, seaborn, plotly など

### 3.2 起動方法

アプリケーションを起動するには、`scripts`ディレクトリから次のコマンドを実行します：
```
run_app.bat
```

このバッチファイルは以下の処理を行います：
- 仮想環境を有効化
- アプリケーションのルートディレクトリに移動
- PYTHONPATHを設定
- `src/main.py`を実行してアプリケーションを起動

### 3.3 サンプルデータの生成

テスト用のサンプルデータを生成するには、仮想環境が有効な状態で次のコマンドを実行します：
```
python generate_sample_data.py
```

これにより、`data/sample_data.json`に3人のライダー（A、B、C）の模擬ラップデータが生成されます。
- ライダーA: 安定した速いラップタイム
- ライダーB: 不安定だが時々速いラップタイム
- ライダーC: 徐々に向上するラップタイム

## 4. 基本的な使い方

### 4.1 アプリケーションの起動

1. `scripts`ディレクトリにある`run_app.bat`をダブルクリックするか、コマンドプロンプトから実行します。
2. アプリケーションのメインウィンドウが表示されます。

### 4.2 サンプルデータの使用

初めて使用する場合は、サンプルデータを生成して使用することをお勧めします：

1. `scripts`ディレクトリで`generate_sample_data.py`を実行します。
2. 生成されたサンプルデータ（`data/sample_data.json`）をアプリケーションで開きます。

### 4.3 データの読み込み

1. メニューの「File」から「Open JSON」または「Open CSV」を選択します。
2. ファイル選択ダイアログでデータファイルを選択します。
3. データが読み込まれると、「情報」ダイアログが表示されます。
4. 「Analyze Data」ボタンをクリックして、データの分析を開始します。

### 4.4 データの入力・編集

1. データ入力ウィジェットでライダー、ラップ番号、ラップタイム、セクタータイムを入力します。
2. 「Add Lap」ボタンをクリックしてデータを追加します。
3. タイヤタイプ、天候、路面温度などの走行条件も記録できます。
4. データを変更した場合は、再度「Analyze Data」ボタンをクリックして分析を更新します。
5. テーブル内の選択行のみを削除するには「Delete Selected」ボタンを使用します。

### 4.5 グラフ表示

1. グラフウィンドウが表示されます（データ分析後）。
2. グラフタイプを選択することで、異なる視点からデータを確認できます：
   - Lap Time Trend: ラップタイムの推移
   - Sector Time Trend: セクタータイムの推移
   - Sector Time Comparison: セクター間の比較
   - Lap Time Histogram: ラップタイム分布
   - Performance Radar: パフォーマンスレーダーチャート
3. 「All Riders」または個別のライダーを選択して表示を切り替えられます。

### 4.6 セッション設定

1. メニューの「Settings」から「Session Settings」を選択します。
2. セッション名、日付、サーキット名などの情報を設定できます。
3. ライダーやタイヤの情報を管理できます。
4. ここで設定したサーキット名と日付は、データ保存時にファイル名に自動的に反映されます。

### 4.7 データの保存

1. メニューの「File」から「Save」を選択します。
2. ファイル保存ダイアログでベースとなるファイル名を指定します。
3. データは以下の2つの形式で自動的に保存されます：
   - JSONファイル: セッション情報とラップデータを含む詳細な形式
   - CSVファイル: ラップデータのみを含むシンプルな形式
4. CSVファイル名には、セッション設定で指定したサーキット名と日付が自動的に追加されます（例: `mydata_鈴鹿サーキット_20250315.csv`）。

## 5. データ形式

### 5.1 JSONデータ形式

```json
{
  "session_info": {
    "track": "Suzuka Circuit",
    "date": "2024-03-15",
    "session_type": "Practice",
    "track_length": 5.807
  },
  "lap_data": [
    {
      "Rider": "Rider A",
      "Lap": 1,
      "LapTime": "1:34.567",
      "Sector1": "31.123",
      "Sector2": "26.234",
      "Sector3": "34.321",
      "conditions": {
        "tire": "soft",
        "weather": "dry",
        "track_temp": 26.5
      }
    }
  ]
}
```

サンプルデータジェネレーター（`generate_sample_data.py`）を使用すると、上記のような形式のデータが自動的に生成されます。データには3人のライダー（A、B、C）の特徴的なラップパターンが含まれており、アプリケーションのテストや機能確認に適しています。

### 5.2 CSVデータ形式

```
Rider,Lap,LapTime,Sector1,Sector2,Sector3,TireType,Weather,TrackTemp
Rider1,1,1:45.678,35.123,40.234,30.321,Soft,Dry,25
```

## 6. グラフの種類と機能

### 6.1 ラップタイム推移（Lap Time Trend）

- 各ラップのラップタイムを時系列で表示します。
- 移動平均線も表示され、パフォーマンスの傾向を把握できます。
- 複数ライダーの比較が可能です。

### 6.2 セクタータイム推移（Sector Time Trend）

- 各セクターのタイムを時系列で表示します。
- 問題があるセクターや改善したセクターを特定するのに役立ちます。

### 6.3 セクタータイム比較（Sector Time Comparison）

- 各ライダーのセクターごとの平均タイムを棒グラフで比較します。
- 特定のセクターでの強みや弱みを特定できます。

### 6.4 ラップタイム分布（Lap Time Histogram）

- ラップタイムの分布をヒストグラムで表示します。
- パフォーマンスの一貫性を評価するのに役立ちます。

### 6.5 パフォーマンスレーダー（Performance Radar）

- 各セクターのパフォーマンスをレーダーチャートで表示します。
- 標準偏差の範囲も表示され、安定性を評価できます。

## 7. グラフの操作方法

- ズーム: マウスホイールまたは矩形選択でズームインします。
- パン: 右クリックドラッグでグラフを移動します。
- リセット: ホームボタンをクリックすると元のビューに戻ります。
- 保存: 保存ボタンをクリックしてグラフを画像として保存できます。

## 8. トラブルシューティング

1. **データが読み込めない場合**
   - ファイル形式（JSONまたはCSV）が正しいか確認してください。
   - 必要なフィールド（Rider, Lap, LapTime, Sector1, Sector2, Sector3）が含まれているか確認してください。
   - 時間形式が正しいか確認してください（例: 1:23.456, 83.456）。

2. **グラフが表示されない場合**
   - データが正しく読み込まれているか確認してください。
   - 「Analyze Data」ボタンをクリックして分析を実行してください。

3. **時間データが無効と表示される場合**
   - 時間形式が正しいか確認してください（例: 1:23.456, 83.456）。

4. **アプリケーションがクラッシュする場合**
   - ログメッセージを確認してエラーの原因を特定してください。
   - Python環境とライブラリのバージョンが互換性があるか確認してください。
   - 仮想環境が正しく有効化されているか確認してください。

5. **バッチファイルが動作しない場合**
   - Pythonが正しくインストールされ、PATHに設定されているか確認してください。
   - Windows上で実行権限が正しく設定されているか確認してください。

6. **CSVファイル名にサーキット名や日付が反映されない場合**
   - セッション設定で正しくサーキット名（circuit）と日付が設定されているか確認してください。
   - 「Settings」→「Session Settings」から設定を確認し、保存してください。

## 9. 最近のアップデート

- **セッション情報をファイル名に反映**: 保存するCSVファイル名にサーキット名と日付を自動的に追加する機能を追加
- **テーブルデータの選択的削除**: 選択した行のみを削除できる機能を追加
- **データ入力検証の強化**: テーブル編集時にデータ形式を検証し、無効なデータの入力を防止
- 日本語フォント表示の問題を修正
- データ追加時の自動解析問題を修正
- Add Lapダイアログの改善：最新ラップ番号と天候路面温度の自動入力機能を追加
- ラップデータ解析の自動実行防止機能を追加
- 凡例表示の改善：すべてのグラフタイプで凡例が正しく表示されるように調整
- テーブル形式でのライダーとタイヤ管理UIを再実装
- グラフ表示と統計計算の信頼性を向上

## 10. 開発情報

- 開発者: TakeshiArai-18
- バージョン: 1.0
- ライセンス: Copyright © 2025

## 11. システム要件と環境

### 11.1 システム要件

- Windows 10/11（64ビット推奨）
- Python 3.8以上
- 画面解像度: 1280×720以上推奨

### 11.2 必要なライブラリ

アプリケーションは以下の主要なライブラリに依存しています：
- PyQt5 5.15.0以上: UIフレームワーク
- pandas 1.3.0以上: データ処理
- numpy 1.21.0以上: 数値計算
- matplotlib 3.4.0以上: グラフ描画
- seaborn 0.11.0以上: 高度なグラフ描画
- plotly 5.3.0以上: インタラクティブなグラフ

すべての必要なライブラリは`requirements.txt`に記載されており、`create_venv.bat`スクリプトを使用することで自動的にインストールされます。

## 12. お問い合わせ

- GitHub: https://github.com/TakeshiArai-18/RiderAnalyzer